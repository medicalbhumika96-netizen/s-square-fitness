<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QR Attendance</title>

<script src="https://unpkg.com/html5-qrcode"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
body{
  background:#0b0b0b;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
  font-family:Poppins;
  text-align:center;
}
#reader{width:300px}
</style>
</head>
<body>

<div>
  <h2>ðŸ“¸ Scan QR</h2>
  <p id="msg">Opening camera...</p>
  <div id="reader"></div>
</div>

<script>
/* ðŸ”¥ FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyA86S_0IA435DB26Z2RHLQUMbDYFBzge4",
  authDomain: "fir-square-fitness.firebaseapp.com",
  projectId: "fir-square-fitness"
});
const db = firebase.firestore();

/* ðŸ”’ LOGIN CHECK */
const session = JSON.parse(localStorage.getItem("memberSession"));
if(!session){
  document.getElementById("msg").innerText =
    "âŒ Please login from gym website first";
  throw "NO SESSION";
}

/* ðŸ“· QR SCAN */
const qr = new Html5Qrcode("reader");

Html5Qrcode.getCameras().then(devices=>{
  const backCam = devices.find(d =>
    d.label.toLowerCase().includes("back")
  ) || devices[0];

  qr.start(
    backCam.id,
    { fps:10, qrbox:250 },
    async ()=>{
      qr.stop();

      await db.collection("attendance").add({
        user: session.user,
        name: session.name,
        time: new Date(),
        method: "QR"
      });

      document.getElementById("msg").innerText =
        "âœ… Attendance marked successfully";
    }
  );
});
</script>

</body>
</html>
