<!DOCTYPE html>
<html>
<head>
<title>Member Login | S Square Fitness</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body style="text-align:center;font-family:Arial">

<h2>ğŸ” Member Login</h2>

<input id="mid" placeholder="Member ID"><br><br>
<input id="pass" type="password" placeholder="Password"><br><br>
<button onclick="login()">Confirm Attendance</button>

<p id="msg"></p>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* ğŸ”¥ FIREBASE INIT (REAL CONFIG USE KARO) */
firebase.initializeApp({
  apiKey: "YOUR_KEY",
  authDomain: "YOUR_DOMAIN",
  projectId: "YOUR_PROJECT"
});

const db = firebase.firestore();

/* âœ… MEMBER LOGIN + ATTENDANCE */
async function login(){
  const id = mid.value.trim();
  const pw = pass.value.trim();
  msg.innerText = "Checking...";

  if(!id || !pw){
    msg.innerText = "âŒ Enter ID & Password";
    return;
  }

  try{
    const doc = await db.collection("members").doc(id).get();

    if(!doc.exists || doc.data().password !== pw){
      msg.innerText = "âŒ Invalid login";
      return;
    }

    /* ğŸ“… TODAY RANGE (duplicate prevent) */
    const start = new Date();
    start.setHours(0,0,0,0);

    const end = new Date();
    end.setHours(23,59,59,999);

    const already = await db.collection("attendance")
      .where("user","==",id)
      .where("timestamp",">=",start)
      .where("timestamp","<=",end)
      .get();

    if(!already.empty){
      msg.innerText = "âš ï¸ Attendance already marked";
      return;
    }

    /* âœ… SAVE ATTENDANCE */
    await db.collection("attendance").add({
      user: id,
      name: doc.data().name,
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      method: "QR + Login"
    });

    msg.innerText = "âœ… Attendance Marked";

  }catch(err){
    console.error(err);
    msg.innerText = "âŒ Permission / Network error";
  }
}
</script>

</body>
</html>
